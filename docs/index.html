<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Тест по Python — одностраничный сайт</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="container">
    <h1>Тест по Python</h1>
    <form id="quizForm">
      <label>Имя ученика
        <input type="text" name="studentName" required>
      </label>
      <label>Класс/группа
        <input type="text" name="studentClass" required>
      </label>

      <div id="questions"></div>

      <button type="submit">Отправить</button>
    </form>
    <div id="status"></div>
  </main>

  <script>
  const questions = [
    {q: `1) Ввод/вывод\nНапишите что выведет код:\nname = input()\nprint('Hello,', name)`},
    {q: `2) Арифметические операторы\nЧто выведет:\nprint(2 + 3 * 4)`},
    {q: `3) Деление и целая часть\nЧто выведет:\nprint(7 / 2)\nprint(7 // 2)`},
    {q: `4) Остаток от деления\nЧто выведет:\nprint(10 % 3)`},
    {q: `5) Возведение в степень\nЧто выведет:\nprint(2 ** 3)`},
    {q: `6) Операторы сравнения\nЧто выведет:\nprint(5 > 3)\nprint(5 == 5)`},
    {q: `7) Логические операторы\nЧто выведет:\nprint(True and False)\nprint(not False)`},
    {q: `8) Присваивание и комбинированные операторы\nЧто выведет:\nx = 5\nx += 3\nprint(x)`},
    {q: `9) Условные операторы\nЧто выведет:\nif 3 > 2:\n    print('A')\nelse:\n    print('B')`},
    {q: `10) if/elif/else\nЧто выведет:\nif 1 > 2:\n    print(1)\nelif 2 > 1:\n    print(2)\nelse:\n    print(3)`},
    {q: `11) Цикл for (строки)\nЧто выведет:\nfor c in 'ab':\n    print(c)`},
    {q: `12) Цикл for (список)\nЧто выведет:\nfor i in [0,1,2]:\n    print(i)`},
    {q: `13) Цикл while\nЧто выведет:\ni = 0\nwhile i < 3:\n    print(i)\n    i += 1`},
    {q: `14) break/continue\nЧто выведет:\nfor i in range(5):\n    if i == 2:\n        break\n    print(i)`},
    {q: `15) Вложенные условия и циклы\nЧто выведет:\nfor i in range(2):\n    for j in range(2):\n        print(i, j)`}
  ];

  const qContainer = document.getElementById('questions');
  questions.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'question';
    const label = document.createElement('label');
    label.innerHTML = `<strong>Вопрос ${idx+1}</strong><pre>${item.q}</pre>`;
    const ta = document.createElement('textarea');
    ta.name = `q${idx+1}`;
    ta.rows = 3;
    ta.required = true;
    div.appendChild(label);
    div.appendChild(ta);
    qContainer.appendChild(div);
  });

  document.getElementById('quizForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const data = {studentName: form.studentName.value, studentClass: form.studentClass.value, answers: {}};
    for (let i=1;i<=questions.length;i++) data.answers['q'+i] = form['q'+i].value.trim();

    document.getElementById('status').textContent = 'Отправляю...';

    try {
      // Try serverless endpoint first (Vercel/Netlify). If unavailable, fall back to legacy /submit.
      let resp = await fetch('/api/submit', {
        method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)
      }).catch(() => null);

      // If endpoint missing or Method Not Allowed, try legacy /submit (Express local server)
      if (!resp || resp.status === 404 || resp.status === 405) {
        resp = await fetch('/submit', {
          method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)
        }).catch(() => null);
      }

      if (!resp) {
        document.getElementById('status').textContent = 'Ошибка отправки: не удалось связаться с сервером';
        return;
      }

      const respText = await resp.text();
      let json = null;
      try { if (respText) json = JSON.parse(respText); } catch(e) { json = null; }

      if (resp.ok) {
        document.getElementById('status').textContent = 'Отправлено!';
      } else {
        const errMsg = (json && json.error) ? json.error : (resp.statusText || respText || 'Unknown error');
        document.getElementById('status').textContent = 'Ошибка: ' + errMsg;
      }
    } catch (err) {
      document.getElementById('status').textContent = 'Ошибка отправки: ' + err.message;
    }
  });
  </script>
</body>
</html>
